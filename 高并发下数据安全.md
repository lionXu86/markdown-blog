## 并发下的数据安全问题

在单机单进程单线程或者单协程的情况下，公共数据的读写是串行的，不存在判断数据不一致导致数据出问题，但是在并发的情况下，公共数据的读和写不可能顺序执行，就需要有中间件或者数据管理软件做串行化处理。串行化处理的实现有2个方向，一个是队列，一个是锁。

### 锁

锁有很多种，java里就有很多不同场景下使用的不同类型的锁，但是是仅限单机的情况下。实现这些锁，数据库本身就可以实现很强的串行化操作，常用的就是悲观锁和乐观锁。

#### 悲观锁

简单讲就是读写锁，悲观的认为数据在读和写之前都已经被修改过了，所以不管是读还是写都加锁。使用这种锁的确定就是效率不高，一旦加了悲观锁，每个请求都得等待上个请求释放锁，竞争锁，导致请求都阻塞等待，连接超时异常。所以一般使用的不多

#### 乐观锁

简单讲就是写锁，读不加锁，大家都可以读，在写锁竞争的情况下，后面的请求还是可以预先读数据，通过逻辑判断决定是否要进行后续操作，避免都去竞争写锁，缓解系统压力。

### 队列

终极的串行化实现方案。


## 优化方案1
将库存字段number字段设为unsigned，当库存为0时，因为字段不能为负数，将会返回false


